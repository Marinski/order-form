<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –ø–æ—Ä—ä—á–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
            text-align: center;
        }

        h2 {
            color: #764ba2;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
            appearance: none;
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        select {
            background: white;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
            margin-bottom: 30px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #48bb78;
        }

        .btn-clear {
            background: #f56565;
            margin-top: 10px;
        }

        .order-summary {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .order-summary.active {
            display: block;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .summary-header h2 {
            color: #667eea;
            font-size: 26px;
            border: none;
            margin: 0;
        }

        .summary-section {
            margin-bottom: 25px;
        }

        .summary-section h3 {
            color: #764ba2;
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: #666;
            font-weight: 500;
        }

        .summary-value {
            color: #333;
            font-weight: 600;
            text-align: right;
        }

        .total-price {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-top: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button-group .btn {
            margin-top: 0;
        }

        .price-input-group {
            display: flex;
            gap: 10px;
        }

        .price-input-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        @media screen and (max-width: 480px) {
            body {
                padding: 10px;
            }

            .card {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            h2 {
                font-size: 18px;
            }

            .total-price {
                font-size: 16px;
                padding: 15px;
            }

            .product-item {
                padding: 12px;
                margin-bottom: 12px;
            }

            .price-quantity-row {
                gap: 6px;
            }

            .product-total {
                min-width: 60px;
                font-size: 13px;
            }

            /* Prevent zoom cropping issues on mobile */
            body {
                position: fixed;
                width: 100%;
            }
            
            .container {
                height: 100vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 100px;
            }

            /* Ensure submit button is never hidden behind mobile UI */
            .btn {
                margin-bottom: 50px !important;
            }
        }

        .hidden {
            display: none;
        }

        .total-price-input {
            background: #f9f9f9 !important;
            font-weight: bold;
            color: #667eea;
        }

        .order-date {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        #addressGroup {
            display: none;
        }

        .product-item {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .product-number {
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
        }

        .remove-product {
            background: #f56565;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }



        .product-select {
            margin-bottom: 10px;
        }

        .price-quantity-row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 10px;
        }

        .price-input {
            flex: 1;
        }

        .price-input input {
            font-size: 16px !important;
            padding: 10px 12px;
        }

        /* Ensure consistent font size for all number inputs to prevent zoom */
        input[type="number"] {
            font-size: 16px !important;
        }

        .quantity-input {
            flex: 1;
        }

        .quantity-input input {
            font-size: 16px !important;
            padding: 10px 8px;
            text-align: center;
        }

        .product-total {
            min-width: 70px;
            text-align: right;
            font-weight: bold;
            color: #667eea;
            font-size: 14px;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .btn-add-product {
            background: #48bb78;
            margin-bottom: 15px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .customer-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-icon:active {
            transform: scale(0.95);
        }

        .btn-search {
            background: #4299e1;
            color: white;
        }

        .btn-save {
            background: #48bb78;
            color: white;
        }

        .btn-icon:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .input-with-button {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .input-with-button input {
            flex: 1;
        }

        .input-with-button .btn-icon {
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="formSection" class="card">
            <h1>üì¶ –ù–æ–≤–∞ –ø–æ—Ä—ä—á–∫–∞</h1>
            
            <form id="orderForm">
                <div class="section-header">
                    <h2>üë§ –î–∞–Ω–Ω–∏ –∑–∞ –∫–ª–∏–µ–Ω—Ç</h2>
                    <div class="customer-actions">
                        <button type="button" class="btn-icon btn-save" onclick="saveCustomer()" title="–ó–∞–ø–∞–∑–∏ –∫–ª–∏–µ–Ω—Ç">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customerName">–î–≤–µ –∏–º–µ–Ω–∞ *</label>
                    <input type="text" id="customerName" required placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
                </div>

                <div class="form-group">
                    <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <div class="input-with-button">
                        <input type="tel" id="phone" required placeholder="0888 123 456">
                        <button type="button" class="btn-icon btn-search" onclick="searchCustomer()" title="–¢—ä—Ä—Å–∏ –∫–ª–∏–µ–Ω—Ç –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="deliveryType">–ù–∞—á–∏–Ω –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ *</label>
                    <select id="deliveryType" required onchange="toggleAddressField()">
                        <option value="">–ò–∑–±–µ—Ä–∏ –Ω–∞—á–∏–Ω –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞...</option>
                        <option value="econt">–û—Ñ–∏—Å –Ω–∞ –ï–∫–æ–Ω—Ç</option>
                        <option value="speedy">–û—Ñ–∏—Å –Ω–∞ –°–ø–∏–¥–∏</option>
                        <option value="address">–î–æ –∞–¥—Ä–µ—Å</option>
                    </select>
                </div>

                <div class="form-group" id="addressGroup">
                    <label for="address" id="addressLabel">–ê–¥—Ä–µ—Å –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ *</label>
                    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –∏–ª–∏ –æ—Ñ–∏—Å...">
                </div>

                <h2>üìã –î–∞–Ω–Ω–∏ –∑–∞ –ø–æ—Ä—ä—á–∫–∞</h2>

                <div id="productsList">
                    <!-- Products will be added here dynamically -->
                </div>

                <button type="button" class="btn btn-add-product" onclick="addProduct()">‚ûï –î–æ–±–∞–≤–∏ –ø—Ä–æ–¥—É–∫—Ç</button>

                <div class="form-group">
                    <label for="totalPrice">–û–±—â–∞ —Ü–µ–Ω–∞ (‚Ç¨)</label>
                    <input type="text" id="totalPrice" readonly placeholder="0.00 ‚Ç¨" class="total-price-input">
                </div>

                <button type="submit" class="btn">–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ø–æ—Ä—ä—á–∫–∞</button>
            </form>
        </div>

        <div id="orderSummary" class="order-summary">
            <div class="summary-header">
                <h2>‚úÖ –ü–û–†–™–ß–ö–ê</h2>
                <div id="orderDate" class="order-date"></div>
            </div>

            <div class="summary-section">
                <h3>–ö–ª–∏–µ–Ω—Ç</h3>
                <div class="summary-row">
                    <span class="summary-label">–ò–º–µ:</span>
                    <span class="summary-value" id="summaryName"></span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                    <span class="summary-value" id="summaryPhone"></span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                    <span class="summary-value" id="summaryDeliveryType"></span>
                </div>
                <div class="summary-row hidden" id="summaryAddressRow">
                    <span class="summary-label">–ê–¥—Ä–µ—Å:</span>
                    <span class="summary-value" id="summaryAddress"></span>
                </div>
            </div>

            <div class="summary-section">
                <h3>–ü–æ—Ä—ä—á–∞–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</h3>
                <div id="summaryProducts">
                    <!-- Products will be listed here -->
                </div>
            </div>

            <div class="total-price">
                –û–ë–©–ê –¶–ï–ù–ê: <span id="summaryTotal"></span>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="shareOrder()">üì§ –°–ø–æ–¥–µ–ª–∏</button>
                <button class="btn btn-clear" onclick="newOrder()">üîÑ –ù–æ–≤–∞ –ø–æ—Ä—ä—á–∫–∞</button>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let productCounter = 0;
        const orderForm = document.getElementById('orderForm');

        // Customer database configuration
        // API endpoint on your server
        const API_URL = 'https://polynor.bg/order/customers-api.php';

        // Customer database functions
        async function getCustomerDatabase() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Failed to load');
                return await response.json();
            } catch (error) {
                console.error('Error loading customers:', error);
                // Fallback to localStorage if server is unavailable
                const data = localStorage.getItem('customerDatabase');
                return data ? JSON.parse(data) : { customers: [] };
            }
        }

        async function saveCustomerDatabase(database) {
            // Always save to localStorage as backup
            localStorage.setItem('customerDatabase', JSON.stringify(database));
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(database)
                });
                return response.ok;
            } catch (error) {
                console.error('Error saving customers:', error);
                return false;
            }
        }

        async function saveCustomer() {
            const customerName = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const deliveryType = document.getElementById('deliveryType').value;
            const address = document.getElementById('address').value.trim();

            if (!phone) {
                alert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä –∑–∞ –∑–∞–ø–∞–∑–≤–∞–Ω–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞!');
                return;
            }

            if (!customerName) {
                alert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞!');
                return;
            }

            const database = await getCustomerDatabase();
            
            // Check if customer with this phone already exists
            const existingIndex = database.customers.findIndex(c => c.phone === phone);
            
            const customerData = {
                name: customerName,
                phone: phone,
                deliveryType: deliveryType,
                address: address,
                updatedAt: new Date().toISOString()
            };

            if (existingIndex !== -1) {
                // Update existing customer
                database.customers[existingIndex] = customerData;
            } else {
                // Add new customer
                database.customers.push(customerData);
            }

            const saved = await saveCustomerDatabase(database);
            
            if (existingIndex !== -1) {
                alert('–î–∞–Ω–Ω–∏—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞ —Å–∞ –æ–±–Ω–æ–≤–µ–Ω–∏ —É—Å–ø–µ—à–Ω–æ!');
            } else {
                alert('–ö–ª–∏–µ–Ω—Ç—ä—Ç –µ –∑–∞–ø–∞–∑–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
            }
        }

        async function searchCustomer() {
            const phone = document.getElementById('phone').value.trim();

            if (!phone) {
                alert('–ú–æ–ª—è –≤—ä–≤–µ–¥–µ—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ!');
                return;
            }

            const database = await getCustomerDatabase();
            const customer = database.customers.find(c => c.phone === phone);

            if (customer) {
                document.getElementById('customerName').value = customer.name;
                document.getElementById('phone').value = customer.phone;
                document.getElementById('deliveryType').value = customer.deliveryType || '';
                
                // Trigger address field visibility
                toggleAddressField();
                
                if (customer.address) {
                    document.getElementById('address').value = customer.address;
                }
                
                alert('–ö–ª–∏–µ–Ω—Ç—ä—Ç –µ –Ω–∞–º–µ—Ä–µ–Ω –∏ –¥–∞–Ω–Ω–∏—Ç–µ —Å–∞ –ø–æ–ø—ä–ª–Ω–µ–Ω–∏!');
            } else {
                alert('–ù–µ –µ –Ω–∞–º–µ—Ä–µ–Ω –∫–ª–∏–µ–Ω—Ç —Å —Ç–æ–∑–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä.');
            }
        }

        const productOptions = [
            'Polynor Pro',
            'Polynor Home',
            'Polynor Premium Mega Pro 70',
            'Polynor Windows & Doors',
            'Polynor Fixo',
            'Polynor Premium Gun',
            'Insola Gun Foam',
            '–ß–∏—Å—Ç–∏—Ç–µ–ª Insola Foam Cleaner',
            '–ú–æ–Ω—Ç–∞–∂–µ–Ω –Ω–∞–∫—Ä–∞–π–Ω–∏–∫'
        ];

        function toggleAddressField() {
            const deliveryType = document.getElementById('deliveryType').value;
            const addressGroup = document.getElementById('addressGroup');
            const addressLabel = document.getElementById('addressLabel');
            
            if (deliveryType === 'address') {
                addressGroup.style.display = 'block';
                addressLabel.textContent = '–ê–¥—Ä–µ—Å –∑–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ *';
                document.getElementById('address').placeholder = '—É–ª. –í–∏—Ç–æ—à–∞ 1, –°–æ—Ñ–∏—è';
            } else if (deliveryType === 'econt' || deliveryType === 'speedy') {
                addressGroup.style.display = 'block';
                const company = deliveryType === 'econt' ? '–ï–∫–æ–Ω—Ç' : '–°–ø–∏–¥–∏';
                addressLabel.textContent = `–û—Ñ–∏—Å –Ω–∞ ${company} *`;
                document.getElementById('address').placeholder = `${company} - –°–æ—Ñ–∏—è, —É–ª. –í–∏—Ç–æ—à–∞ 1`;
            } else {
                addressGroup.style.display = 'none';
            }
        }

        function addProduct() {
            productCounter++;
            const productsList = document.getElementById('productsList');
            
            const productDiv = document.createElement('div');
            productDiv.className = 'product-item';
            productDiv.setAttribute('data-product-id', productCounter);
            
            productDiv.innerHTML = `
                <div class="product-header">
                    <span class="product-number">–ü—Ä–æ–¥—É–∫—Ç #${productCounter}</span>
                    <button type="button" class="remove-product" onclick="removeProduct(${productCounter})">√ó</button>
                </div>
                
                <div class="form-group product-select">
                    <select id="product${productCounter}" required onchange="updateProduct(${productCounter})">
                        <option value="">–ò–∑–±–µ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç...</option>
                        ${productOptions.map(option => `<option value="${option}">${option}</option>`).join('')}
                    </select>
                </div>
                
                <div class="price-quantity-row">
                    <div class="form-group quantity-input">
                        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                        <input type="number" id="quantity${productCounter}" required min="1" value="1" onchange="updateProduct(${productCounter})">
                    </div>
                    
                    <div class="form-group price-input">
                        <label>–¶–µ–Ω–∞ (‚Ç¨) *</label>
                        <input type="number" id="price${productCounter}" required min="0" step="0.01" placeholder="0.00" onchange="updateProduct(${productCounter})">
                    </div>
                    
                    <div class="product-total" id="productTotal${productCounter}">0.00 ‚Ç¨</div>
                </div>
            `;
            
            productsList.appendChild(productDiv);
            
            // Add product to products array
            products.push({
                id: productCounter,
                name: '',
                price: 0,
                quantity: 1,
                total: 0
            });
            
            updateTotalPrice();
        }

        function removeProduct(productId) {
            const productDiv = document.querySelector(`[data-product-id="${productId}"]`);
            productDiv.remove();
            
            // Remove from products array
            products = products.filter(p => p.id !== productId);
            updateTotalPrice();
        }

        function updateProduct(productId) {
            const productSelect = document.getElementById(`product${productId}`);
            const priceInput = document.getElementById(`price${productId}`);
            const quantityInput = document.getElementById(`quantity${productId}`);
            const totalSpan = document.getElementById(`productTotal${productId}`);
            
            const name = productSelect.value;
            const price = parseFloat(priceInput.value) || 0;
            const quantity = parseInt(quantityInput.value) || 1;
            
            // Ensure minimum quantity of 1
            if (quantity < 1) {
                quantityInput.value = 1;
                quantity = 1;
            }
            
            const total = (price * quantity).toFixed(2);
            
            totalSpan.textContent = total + ' ‚Ç¨';
            
            // Update products array
            const productIndex = products.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                products[productIndex] = {
                    id: productId,
                    name: name,
                    price: price,
                    quantity: quantity,
                    total: parseFloat(total)
                };
            }
            
            updateTotalPrice();
        }

        function updateTotalPrice() {
            const total = products.reduce((sum, product) => sum + product.total, 0);
            document.getElementById('totalPrice').value = total.toFixed(2) + ' ‚Ç¨';
        }

        // Add first product automatically
        addProduct();

        // Handle form submission
        orderForm.addEventListener('submit', function(e) {
            e.preventDefault();

            if (products.length === 0 || products.every(p => !p.name)) {
                alert('–ú–æ–ª—è –¥–æ–±–∞–≤–µ—Ç–µ –ø–æ–Ω–µ –µ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç!');
                return;
            }

            // Get form values
            const customerName = document.getElementById('customerName').value;
            const phone = document.getElementById('phone').value;
            const deliveryType = document.getElementById('deliveryType').value;
            const address = document.getElementById('address').value;

            // Fill summary
            document.getElementById('summaryName').textContent = customerName;
            document.getElementById('summaryPhone').textContent = phone;
            
            const deliveryTypeText = {
                'econt': '–û—Ñ–∏—Å –Ω–∞ –ï–∫–æ–Ω—Ç',
                'speedy': '–û—Ñ–∏—Å –Ω–∞ –°–ø–∏–¥–∏',
                'address': '–î–æ –∞–¥—Ä–µ—Å'
            };
            document.getElementById('summaryDeliveryType').textContent = deliveryTypeText[deliveryType];
            
            const addressRow = document.getElementById('summaryAddressRow');
            if (deliveryType && address) {
                document.getElementById('summaryAddress').textContent = address;
                addressRow.classList.remove('hidden');
            } else {
                addressRow.classList.add('hidden');
            }

            // Fill products summary
            const summaryProducts = document.getElementById('summaryProducts');
            summaryProducts.innerHTML = '';
            
            let grandTotal = 0;
            products.filter(p => p.name).forEach(product => {
                const productRow = document.createElement('div');
                productRow.className = 'summary-row';
                productRow.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${product.name}</strong><br>
                        <small>${product.quantity} –±—Ä. √ó ${product.price.toFixed(2)} ‚Ç¨</small>
                    </div>
                    <div style="text-align: right; font-weight: bold;">
                        ${product.total.toFixed(2)} ‚Ç¨
                    </div>
                `;
                summaryProducts.appendChild(productRow);
                grandTotal += product.total;
            });

            document.getElementById('summaryTotal').textContent = grandTotal.toFixed(2) + ' ‚Ç¨';

            // Set current date
            const now = new Date();
            const dateStr = now.toLocaleDateString('bg-BG', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('orderDate').textContent = dateStr;

            // Show summary, hide form
            document.getElementById('formSection').classList.add('hidden');
            document.getElementById('orderSummary').classList.add('active');

            // Scroll to top
            window.scrollTo(0, 0);
        });

        function shareOrder() {
            const name = document.getElementById('summaryName').textContent;
            const phone = document.getElementById('summaryPhone').textContent;
            const deliveryType = document.getElementById('summaryDeliveryType').textContent;
            const address = document.getElementById('summaryAddress').textContent;
            const total = document.getElementById('summaryTotal').textContent;

            let text = `–ü–û–†–™–ß–ö–ê\n\n`;
            text += `–ö–õ–ò–ï–ù–¢:\n`;
            text += `–ò–º–µ: ${name}\n`;
            text += `–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n`;
            text += `–î–æ—Å—Ç–∞–≤–∫–∞: ${deliveryType}\n`;
            if (address) {
                text += `–ê–¥—Ä–µ—Å: ${address}\n`;
            }
            text += `\n–ü–†–û–î–£–ö–¢–ò:\n`;
            
            products.filter(p => p.name).forEach(product => {
                text += `‚Ä¢ ${product.name}\n`;
                text += `  ${product.quantity} –±—Ä. √ó ${product.price.toFixed(2)} ‚Ç¨ = ${product.total.toFixed(2)} ‚Ç¨\n`;
            });
            
            text += `\n–û–ë–©–ê –¶–ï–ù–ê: ${total}`;

            if (navigator.share) {
                navigator.share({
                    title: '–ü–æ—Ä—ä—á–∫–∞',
                    text: text
                }).catch(err => console.log('Error sharing:', err));
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('–ü–æ—Ä—ä—á–∫–∞—Ç–∞ –µ –∫–æ–ø–∏—Ä–∞–Ω–∞ –≤ –∫–ª–∏–ø–±–æ—Ä–¥–∞');
                });
            }
        }

        function newOrder() {
            // Reset form
            document.getElementById('orderForm').reset();
            
            // Clear products
            products = [];
            productCounter = 0;
            document.getElementById('productsList').innerHTML = '';
            
            // Add first product
            addProduct();
            
            // Hide address field
            document.getElementById('addressGroup').style.display = 'none';
            
            // Show form, hide summary
            document.getElementById('formSection').classList.remove('hidden');
            document.getElementById('orderSummary').classList.remove('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html>
